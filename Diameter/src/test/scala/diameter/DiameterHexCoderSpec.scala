package diameter

import akka.util.ByteString
import diameter.Coder.DiameterCoder
import diameter.Dictionary.xml.DictionaryXMLStorage
import org.scalatest.{BeforeAndAfterAll, FlatSpec}

class DiameterHexCoderSpec extends FlatSpec with BeforeAndAfterAll{
  implicit val dictionary:DictionaryXMLStorage = new DictionaryXMLStorage(getClass.getResource("/dictionary/dictionary.xml").getPath)

  val samplesAvp = Seq(
    "0x000001b540000008"
    ,"0x000001b74000000c00000001000001b540000008000001b04000000c0000000b"
    ,"0x000001074000008574356d74617339312e696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72673b31323439323330383b323531353039303237363b31333832303b35333b313b7369703a2b34323037373030303135323440696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f7267000000"
    ,"0x000001b74000000c00000001000001b540000008000001be40000014000001a44000000c0000000000000368c0000010000028af00000006000001b04000000c0000000b"
    ,"0x000001c84000004c000001b74000000c00000001000001b540000008000001be40000014000001a44000000c0000000000000368c0000010000028af00000006000001b04000000c0000000b"
    ,"0x0000033dc0000010000028af000000000000035ec0000010000028af000000060000033ec000002c000028af70363535343274313434393834373932336d343832313534633135363038733200000910c000002c000028af70363535343174313434393834373830326d393635383834633133383031733200000349c0000029000028af6d4f54696e35363661656337343731366263303031303030303335666300000000000337c0000020000028af00000338c0000012000028af494e5649544500000000033fc000003f000028af7369703a2b34323037373030303135323440696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f7267000000033fc000001d000028af74656c3a2b34323037373030303135323400000000000340c000001d000028af74656c3a2b34323037373030303135323300000000000341c000002c000028af00000342c0000010000028afda156af400000343c0000010000028afda156af50000034ac000000f000028af763d30000000034ac0000039000028af6f3d2d2031333233393137373838203432383333363136363420494e204950342031302e32312e3134372e31330000000000034ac0000014000028af733d535320494d530000034ac000001e000028af633d494e204950342031302e382e32312e3600000000034ac0000013000028af623d41533a3431000000034ac0000014000028af623d52533a3531320000034ac0000015000028af623d52523a313533370000000000034ac0000011000028af743d3020300000000000034ac0000016000028af613d73656e647265637600000000034bc0000178000028af0000034cc0000029000028af6d3d617564696f203438393436205254502f41565020313136203131310000000000034dc000001e000028af633d494e204950342031302e382e32312e3600000000034dc0000013000028af623d41533a3431000000034dc0000016000028af613d73656e647265637600000000034dc0000025000028af613d7274706d61703a31313620414d522d57422f31363030300000000000034dc000002e000028af613d7274706d61703a3131312074656c6570686f6e652d6576656e742f313630303000000000034dc000003a000028af613d666d74703a313136206d61782d7265643d303b206d6f64652d6368616e67652d6361706162696c6974793d3200000000034dc000001b000028af613d666d74703a31313120302d3135000000034dc0000016000028af613d7074696d653a323000000000034dc0000019000028af613d6d61787074696d653a343000000000000372c0000010000028af00000001000004e1c000002c000028af000004e9c0000010000028afab0003e90000035fc000000d000028af30000000000004e1c000002c000028af000004e9c0000010000028afab0003ea0000035fc000000e000028af33320000"
  ).map(DiameterCoder.encodeOctetString)
  val samplesMsg = Seq(
    "0x010000808000010100000000000000010000000100000108400000126c6f63616c2d686f7374000000000128400000136c6f63616c2d7265616c6d00000001014000000e0001c0a8969b00000000010a4000000c000000c10000010d0000000d45435a4657000000000001094000000c000028af000001024000000c00000004"
    ,"0x0100007800000101000000000000000200000002000001084000001663686164312e726d2e6c6f63616c000000000128400000146572696373736f6e2e636f6d000001014000000e0001c0a8960600000000010a4000000c000000c10000010d0000000f4348412e444c42000000010c4000000c00001392"
    ,"0x0100041cc000011000000004140057a3140057a3000001074000008574356d74617339312e696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72673b31323439323330383b323531353039303237363b31333832303b35333b313b7369703a2b34323037373030303135323440696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72670000000000012840000013564f4441464f4e452e435a00000001084000003274356d74617339312e696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72670000000001a04000000c000000030000019f4000000c00000003000001024000000c00000004000001cd400000203030332e3233302e392e333232363040336770702e6f7267000000374000000cda156b2e000001bb40000050000001c24000000c00000002000001bc4000003b7369703a2b34323037373030303135323440696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f726700000001c74000000c00000001000001c840000044000001b74000000c00000001000001be40000014000001a44000000c0000003800000368c0000010000028af00000002000001b04000000c0000000b00000369c0000224000028af0000036cc0000218000028af0000033dc0000010000028af000000000000035ec0000010000028af000000060000033ec000002c000028af70363535343274313434393834373932336d343832313534633135363038733200000910c000002c000028af70363535343174313434393834373830326d393635383834633133383031733200000349c0000029000028af6d4f54696e35363661656337343731366263303031303030303335666300000000000337c000001c000028af00000338c000000f000028af425945000000033fc000003f000028af7369703a2b34323037373030303135323440696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f7267000000033fc000001d000028af74656c3a2b34323037373030303135323400000000000340c000001d000028af74656c3a2b34323037373030303135323300000000000341c000001c000028af00000342c0000010000028afda156b2e00000346c000003c000028af00000347c000002d000028af696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f7267000000000004efc000000c000028af0000035dc0000010000028af00000000000004e1c000002c000028af000004e9c0000010000028afab0003e90000035fc000000d000028af30000000000004e1c000002c000028af000004e9c0000010000028afab0003ea0000035fc000000e000028af333200000000011b40000013564f4441464f4e452e435a0000000125400000104c364d4341535431"
    ,"0x010001204000011000000004140057a3140057a3000001074000008574356d74617339312e696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72673b31323439323330383b323531353039303237363b31333832303b35333b313b7369703a2b34323037373030303135323440696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72670000000000010c4000000c000007d100000108400000104c364d43415354310000012840000013564f4441464f4e452e435a00000001024000000c00000004000001a04000000c000000030000019f4000000c00000003000000374000000cda156b2d000001b800000024000001b90000000caa01012e000001ba0000000d437a656368000000"
    ,"0x01000950c0000110000000041400578b1400578b000001074000008574356d74617339312e696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72673b31323439323330383b313334373132313934383b31333831373b35323b313b7369703a2b34323037373030303135323040696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72670000000000012840000013564f4441464f4e452e435a00000001084000003274356d74617339312e696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72670000000001a04000000c000000010000019f4000000c00000000000001024000000c00000004000001cd400000203030332e3233302e392e333232363040336770702e6f7267000000374000000cda156ae3000001bb40000050000001c24000000c00000002000001bc4000003b7369703a2b34323037373030303135323040696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f726700000001c74000000c00000001000001c840000028000001b74000000c00000001000001b540000008000001b04000000c0000000b00000369c0000784000028af0000036cc0000778000028af0000033dc0000010000028af000000000000035ec0000010000028af000000060000033ec000002c000028af70363535343274313434393834373930366d353133323038633135363037733200000349c0000028000028af3363373238323966306366363830626539653134346664336663306600000337c0000020000028af00000338c0000012000028af494e5649544500000000033fc000003f000028af7369703a2b34323037373030303135323040696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f7267000000033fc000001d000028af74656c3a2b34323037373030303135323000000000000340c000004f000028af7369703a2b3432303737303030313531383b6e70646940696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72673b757365723d70686f6e6500000004e3c000004a000028af7369703a2b34323037373030303135313840696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72673b757365723d70686f6e65000000000341c000001c000028af00000342c0000010000028afda156ae300000346c000003c000028af00000347c000002d000028af696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72670000000000034ac000000f000028af763d30000000034ac0000035000028af6f3d2d2035363333383033313020393133373332363520494e204950342031302e32312e3134372e360000000000034ac0000014000028af733d535320494d530000034ac0000021000028af633d494e204950342031302e32312e3134362e33360000000000034ac0000013000028af623d41533a3431000000034ac0000014000028af623d52533a3531320000034ac0000015000028af623d52523a313533370000000000034ac0000011000028af743d3020300000000000034bc000042c000028af0000034cc000003f000028af6d3d617564696f203130333130205254502f415650203131362031303720313138203936203131312031313020392031382038000000034dc0000013000028af623d41533a3431000000034dc0000014000028af623d52533a3531320000034dc0000015000028af623d52523a313533370000000000034dc0000027000028af613d7274706d61703a31313620414d522d57422f31363030302f31000000034dc0000039000028af613d666d74703a313136206d6f64652d6368616e67652d6361706162696c6974793d323b6d61782d7265643d300000000000034dc0000027000028af613d7274706d61703a31303720414d522d57422f31363030302f31000000034dc0000047000028af613d666d74703a313037206f637465742d616c69676e3d313b6d6f64652d6368616e67652d6361706162696c6974793d323b6d61782d7265643d30000000034dc0000023000028af613d7274706d61703a31313820414d522f383030302f31000000034dc0000039000028af613d666d74703a313138206d6f64652d6368616e67652d6361706162696c6974793d323b6d61782d7265643d300000000000034dc0000022000028af613d7274706d61703a393620414d522f383030302f3100000000034dc0000046000028af613d666d74703a3936206f637465742d616c69676e3d313b6d6f64652d6368616e67652d6361706162696c6974793d323b6d61782d7265643d3000000000034dc000002e000028af613d7274706d61703a3131312074656c6570686f6e652d6576656e742f313630303000000000034dc000001b000028af613d666d74703a31313120302d3135000000034dc000002d000028af613d7274706d61703a3131302074656c6570686f6e652d6576656e742f383030300000000000034dc000001b000028af613d666d74703a31313020302d3135000000034dc0000020000028af613d7274706d61703a3920473732322f383030300000034dc0000021000028af613d7274706d61703a313820473732392f383030300000000000034dc0000020000028af613d7274706d61703a382050434d412f383030300000034dc0000021000028af613d637572723a716f73206c6f63616c206e6f6e650000000000034dc0000022000028af613d637572723a716f732072656d6f7465206e6f6e6500000000034dc000002e000028af613d6465733a716f73206d616e6461746f7279206c6f63616c2073656e647265637600000000034dc000002e000028af613d6465733a716f73206f7074696f6e616c2072656d6f74652073656e647265637600000000034dc0000016000028af613d73656e647265637600000000034dc000001a000028af613d6d61787074696d653a32343000000000034dc0000016000028af613d7074696d653a3230000000000372c0000010000028af00000001000004efc0000029000028af334750502d452d555452414e3b6e6574776f726b2d70726f7669646564000000000004e1c000002c000028af000004e9c0000010000028afab0003e90000035fc000000d000028af30000000000004e1c000002c000028af000004e9c0000010000028afab0003ea0000035fc000000e000028af333200000000011b40000013564f4441464f4e452e435a00"
    ,"0x0100019840000110000000041400579614005796000001074000008574356d74617339312e696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72673b31323439323330383b323531353039303237363b31333832303b35333b313b7369703a2b34323037373030303135323440696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72670000000000010c4000000c000007d100000108400000104c364d43415354310000012840000013564f4441464f4e452e435a00000001024000000c00000004000001a04000000c000000010000019f4000000c00000000000001a24000000c00000000000000374000000cda156af4000001c840000050000001af40000014000001a44000000c000004b0000001b04000000c0000000b000001c04000000c000005dc0000010c4000000c000007d100000366c0000010000028af00000028000001ab4000000c000000010000011a400000104c364d4341535431000001b800000024000001b90000000caa01012e000001ba0000000d437a656368000000"
    ,"0x01000644c0000110000000041400579814005798000001074000008574356d74617339312e696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72673b31323439323330383b323531353039303237363b31333832303b35333b313b7369703a2b34323037373030303135323440696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72670000000000012840000013564f4441464f4e452e435a00000001084000003274356d74617339312e696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f72670000000001a04000000c000000020000019f4000000c00000002000001024000000c00000004000001cd400000203030332e3233302e392e333232363040336770702e6f7267000000374000000cda156af6000001bb40000050000001c24000000c00000002000001bc4000003b7369703a2b34323037373030303135323440696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f726700000001c74000000c00000001000001c84000004c000001b74000000c00000001000001b540000008000001be40000014000001a44000000c0000000000000368c0000010000028af00000006000001b04000000c0000000b00000369c0000444000028af0000036cc0000438000028af0000033dc0000010000028af000000000000035ec0000010000028af000000060000033ec000002c000028af70363535343274313434393834373932336d343832313534633135363038733200000910c000002c000028af70363535343174313434393834373830326d393635383834633133383031733200000349c0000029000028af6d4f54696e35363661656337343731366263303031303030303335666300000000000337c0000020000028af00000338c0000012000028af494e5649544500000000033fc000003f000028af7369703a2b34323037373030303135323440696d732e6d6e633030332e6d63633233302e336770706e6574776f726b2e6f7267000000033fc000001d000028af74656c3a2b34323037373030303135323400000000000340c000001d000028af74656c3a2b34323037373030303135323300000000000341c000002c000028af00000342c0000010000028afda156af400000343c0000010000028afda156af50000034ac000000f000028af763d30000000034ac0000039000028af6f3d2d2031333233393137373838203432383333363136363420494e204950342031302e32312e3134372e31330000000000034ac0000014000028af733d535320494d530000034ac000001e000028af633d494e204950342031302e382e32312e3600000000034ac0000013000028af623d41533a3431000000034ac0000014000028af623d52533a3531320000034ac0000015000028af623d52523a313533370000000000034ac0000011000028af743d3020300000000000034ac0000016000028af613d73656e647265637600000000034bc0000178000028af0000034cc0000029000028af6d3d617564696f203438393436205254502f41565020313136203131310000000000034dc000001e000028af633d494e204950342031302e382e32312e3600000000034dc0000013000028af623d41533a3431000000034dc0000016000028af613d73656e647265637600000000034dc0000025000028af613d7274706d61703a31313620414d522d57422f31363030300000000000034dc000002e000028af613d7274706d61703a3131312074656c6570686f6e652d6576656e742f313630303000000000034dc000003a000028af613d666d74703a313136206d61782d7265643d303b206d6f64652d6368616e67652d6361706162696c6974793d3200000000034dc000001b000028af613d666d74703a31313120302d3135000000034dc0000016000028af613d7074696d653a323000000000034dc0000019000028af613d6d61787074696d653a343000000000000372c0000010000028af00000001000004e1c000002c000028af000004e9c0000010000028afab0003e90000035fc000000d000028af30000000000004e1c000002c000028af000004e9c0000010000028afab0003ea0000035fc000000e000028af333200000000011b40000013564f4441464f4e452e435a0000000125400000104c364d4341535431"
  ).map(DiameterCoder.encodeOctetString)

  behavior of "HEX Message coder"

  it should "encode samples" in {
    samplesMsg.foreach(
      sample => DiameterCoder.decodeMessage(DiameterCoder.decodeEarlyMessage(sample))
    )
  }

  behavior of "HEX Avp coder"

  it should "encode samples" in {
    samplesAvp.foreach(
      sample => DiameterCoder.decodeAvp(DiameterCoder.decodeEarlyAvp(ByteString(sample.toArray)))
    )
  }
}
